<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Бронирование картинг-заезда</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        form { max-width: 400px; margin: 0 auto; }
        label { display: block; margin-top: 10px; }
        select, input { width: 100%; padding: 8px; margin-top: 5px; }
        button { margin-top: 20px; padding: 10px; width: 100%; background: #007bff; color: white; border: none; }
    </style>
</head>
<body>
    <h1>Бронирование картинг-заезда</h1>
    <form id="bookingForm">
        <label for="date">Дата:</label>
        <select id="date" required>
            <option value="">Выберите дату</option>
        </select>

        <label for="time">Время:</label>
        <select id="time" required>
            <option value="">Выберите время</option>
        </select>

        <label for="people">Количество человек (1-5):</label>
        <input type="number" id="people" min="1" max="5" required>

        <button type="submit">Забронировать</button>
    </form>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const dateSelect = document.getElementById('date');
        const timeSelect = document.getElementById('time');

        // Заполнить даты (7 дней вперед)
        const today = new Date();
        for (let i = 0; i < 7; i++) {
            const date = new Date(today);
            date.setDate(today.getDate() + i);
            const dateStr = date.toISOString().split('T')[0];
            const label = i === 0 ? 'Сегодня' : i === 1 ? 'Завтра' : date.toLocaleDateString('ru-RU');
            const option = document.createElement('option');
            option.value = dateStr;
            option.textContent = label;
            dateSelect.appendChild(option);
        }

        dateSelect.addEventListener('change', () => {
            const selectedDate = dateSelect.value;
            timeSelect.innerHTML = '<option value="">Выберите время</option>';
            if (!selectedDate) return;

            // Заполнить время (12:00-18:00, интервалы 10 мин)
            const now = new Date();
            const isToday = selectedDate === now.toISOString().split('T')[0];
            for (let hour = 12; hour < 18; hour++) {
                for (let min = 0; min < 60; min += 10) {
                    const time = `${hour.toString().padStart(2, '0')}:${min.toString().padStart(2, '0')}`;
                    if (isToday) {
                        const slotTime = new Date(selectedDate + 'T' + time + ':00');
                        if (slotTime <= now) continue;
                    }
                    const option = document.createElement('option');
                    option.value = time;
                    option.textContent = time;
                    timeSelect.appendChild(option);
                }
            }
        });

        document.getElementById('bookingForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const date = dateSelect.value;
            const time = timeSelect.value;
            const people = document.getElementById('people').value;

            if (!date || !time || !people) {
                alert('Заполните все поля');
                return;
            }

            // Отправить данные в бот
            tg.sendData(JSON.stringify({ date, time, people: parseInt(people) }));
            tg.close();
        });
    </script>
</body>
</html>